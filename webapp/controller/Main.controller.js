sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/ValueHelps","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/customerCode","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/validation","sap/m/MessageToast"],function(e,t,a,i,s,l,r){"use strict";return e.extend("zpj.pro.sk.sd.salesco.zprosalesco.controller.Main",{onInit:function(){this.getOwnerComponent().getRouter().attachRoutePatternMatched(this._onRouteMatched,this);var e={Editable:false};var a={Visible:true};var i=new t(e);var s=new t(a);this.getView().setModel(i,"modelEditFlag");this.getView().setModel(s,"modelVisibleFlag");var l=this.getOwnerComponent().getModel("valueHelp").getData();this.getView().setModel(new t(l),"LocalJSONModels");this.getView().setModel(new t({start:"",end:""}),"dateRange");var r={mode:"None",rowMode:"Single",selBehavior:"RowOnly",deleteButton:false};this.getView().setModel(new t(r),"oGlobleModel")},onSalesOfficeHelp:function(){if(!this.SalesOfficerag){this.SalesOfficerag=sap.ui.xmlfragment("zpj.pro.sk.sd.salesco.zprosalesco.view.fragments.main.salesOfficeF4",this);this.getView().addDependent(this.SalesOfficerag);this._SalesOfficeTemp=sap.ui.getCore().byId("idSLSalesOfficeValueHelp").clone();this._oTemp=sap.ui.getCore().byId("idSLSalesOfficeValueHelp").clone()}var e=[];var t=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"TVKBZ")],false);var a=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,"")],false);var i=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname2",sap.ui.model.FilterOperator.EQ,"")],false);e.push(t);e.push(a);e.push(i);sap.ui.getCore().byId("idSDSalesOfficeF4").bindAggregation("items",{path:"/ET_VALUE_HELPSSet",filters:e,template:this._SalesOfficeTemp});this.SalesOfficerag.open()},onCustomerCodeHelp:function(){s.onCustomerCodeHelp(this)},onValueHelpSearch_custCode:function(e){s.onValueHelpSearch_custCode(e,this)},onValueHelpConfirm_custCode:function(e){var a=this.getOwnerComponent().getModel("payload").getData();a.header.ET_SALES_COORD_ISET.results=[];a.header.ET_SALES_COORD_ISET.results.push(a.item);this.getView().setModel(new t(a.header),"JSONModelPayload");s.onValueHelpConfirm_custCode(e,this)},onCustomerCodeInputSubmit:function(e){s.onCustomerCodeInputSubmit(e,this)},onSuggest_custCode:function(e){s.onSuggest_custCode(e,this)},onCustomerCodeInputChange:function(){s.onCustomerCodeInputChange(this)},onCustomerCodeInputSuggestionSelect:function(e){s.onCustomerCodeInputSuggestionSelect(e,this)},onCustomerCodeLiveChange:function(e){s.onCustomerCodeLiveChange(e)},onVerticalSelectChange:function(e){var t=e.getSource().getSelectedKey();e.getSource().setValueState("None");if(this.sPreviousVertical){a.confirm("Products will be refreshed if Vertical changed, Do you wish to continue ",{actions:["Yes","No"],onClose:function(e){if(e==="Yes"){this.sPreviousVertical=t;this.clearProducts();this.clearSummary()}else{if(this.sPreviousVertical){this.getView().getModel("JSONModelPayload").setProperty("/Spart",this.sPreviousVertical)}}}.bind(this)})}else{this.sPreviousVertical=e.getSource().getSelectedKey()}},onValueHelpSearch:function(e){var t=[];var a=e.getParameter("value");var i="/ET_VALUE_HELPSSet";var s=sap.ui.getCore().byId(e.getParameter("id"));var l=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"TVKBZ")],false);var r=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,a)],false);t.push(l);t.push(r);s.bindAggregation("items",{path:i,filters:t,template:this._oTemp})},onValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");var a=t.getProperty("title");this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.SalesOffice.Input")).setValue(a)},onSalesOfficeInputSubmit:function(e){var t=e.getParameter("value"),a=[],i=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"TVKBZ")],false),s=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,t)],false),l="/Vkbur",r="",o="Entered Sales Office is wrong";a.push(i);a.push(s)},onSuggest:function(e){var i=e.getParameter("suggestValue"),s=[],l="/ET_VALUE_HELPSSet",r,o,d;if(i.includes(",")){var n=i.split(",").length;i=i.split(",")[i.split(",").length-1]}r=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"TVKBZ")],false);o=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,i)],false);d=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname2",sap.ui.model.FilterOperator.EQ,"")],false);s.push(r);s.push(d);s.push(o);if(i){this.getView().setBusy(true);this.getView().getModel().read(l,{filters:s,success:function(e){if(e.results.length>0){var a=new t(e.results);this.getView().setModel(a,"JSONModelForSuggest");this.getView().getModel("JSONModelForSuggest").refresh(true)}this.getView().setBusy(false)}.bind(this),error:function(e){this.getView().setBusy(false);a.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}.bind(this)})}},onSearch:function(){this.getView().getModel("modelVisibleFlag").setProperty("/Visible",true);this.getView().getModel("modelVisibleFlag").refresh(true);this.getView().getModel("modelEditFlag").setProperty("/Editable",false);this.getView().getModel("modelEditFlag").refresh(true);this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false);this.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);var e=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.SalesOffice.Input")).getValue(),i=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.PafNo.Input")).getValue(),s="Enter 'Sales Office' to proceed",l=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","idV1InpCustCode")).getValue(),r=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","idV1SLVertical")).getSelectedKey();if(!e){this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.SalesOffice.Input")).setValueState("Error");this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.SalesOffice.Input")).setValueStateText("Enter Sales Office");this.getView().setModel(new t({}),"ModelForTable");this.getView().setModel(new t({}),"count");this.getView().getModel("ModelForTable").refresh(true);this.getView().getModel("count").refresh(true);a.error(s)}else{this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.SalesOffice.Input")).setValueState("None");if(this.sID==="null"||this.sID===undefined){this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.IconTabBar")).setSelectedKey("All");var o=this.getOwnerComponent().getModel("payload").getData().count;this.getView().setModel(new t(o),"count");e=e.replace(/\s/g,"");var d=new sap.ui.model.Filter([new sap.ui.model.Filter("Vkbur",sap.ui.model.FilterOperator.EQ,e)],false);var n=new sap.ui.model.Filter([new sap.ui.model.Filter("Pafno",sap.ui.model.FilterOperator.EQ,i)],false);var u=new sap.ui.model.Filter([new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.EQ,l)],false);var g=new sap.ui.model.Filter([new sap.ui.model.Filter("Spart",sap.ui.model.FilterOperator.EQ,r)],false);this._getRequestData("","count",d,n,u,g);this._getRequestData("P","count",d,n,u,g);this._getRequestData("A","count",d,n,u,g);this._getRequestData("R","count",d,n,u,g);this._getRequestData("","tableData",d,n,u,g)}}},_submitCall:function(e,t,i,s,l){if(e){var r="/ET_VALUE_HELPSSet";this.getView().setBusy(true);this.getView().getModel().read(r,{filters:t,success:function(e){if(e.results.length===1){this.getView().byId("id.SalesOffice.Input").setValue(e.results[0].DomvalueL)}else{this.getView().byId("id.SalesOffice.Input").setValue("");a.error(l)}this.getView().setBusy(false)}.bind(this),error:function(e){this.getView().setBusy(false);a.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}.bind(this)})}},_onRouteMatched:function(e){this.sID=e.getParameter("arguments").ID},_getRequestData:function(e,i,s,l,r,o){var d=[];var n=new sap.ui.model.Filter([new sap.ui.model.Filter("Status",sap.ui.model.FilterOperator.EQ,e)],false);d.push(n);d.push(s);d.push(l);d.push(r);d.push(o);var u="/ET_ZDI_TP_BILLSet";var g=this;this.getView().setBusy(true);this.getView().getModel().read(u,{filters:d,success:function(a){var s=g.getView().getModel("dateRange").getProperty("/start"),l=g.getView().getModel("dateRange").getProperty("/end");if(s&&l){var r=[];var o=0;for(let e=0;e<a.results.length;e++){if(a.results[e].Erdat>=s&&a.results[e].Erdat<=l){r.push(a.results[e]);o=1}}if(o===1){a.results=r}else{a.results=[]}}g.getView().setBusy(false);if(i==="count"){if(e==="P"){g.aDelayedData=[];g.aPendingData=[];for(var d=0;d<a.results.length;d++){var n=a.results[d];for(var u in n){if(n["Erdat"]){if(u==="Status"){if(n["Status"]==="P"){var c=new Date;if(Math.floor((c-n["Erdat"])/(1e3*3600*24))>1){n["Status"]="D";g.aDelayedData.push(n)}else{g.aPendingData.push(n)}}}}}}}switch(e){case"P":g.getView().getModel("modelEditFlag").setProperty("/Editable",true);g.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(true);g.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);g.getView().getModel("count").getData().onGoing=g.aPendingData.length;g.getView().getModel("count").getData().Delayed=g.aDelayedData.length;break;case"A":g.getView().getModel("modelEditFlag").setProperty("/Editable",false);g.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false);g.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);g.getView().getModel("count").getData().Approved=a.results.length;break;case"R":g.getView().getModel("modelEditFlag").setProperty("/Editable",false);g.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false);g.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);g.getView().getModel("count").getData().Rejected=a.results.length;break;case"D":g.getView().getModel("modelEditFlag").setProperty("/Editable",true);g.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(true);g.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);g.getView().getModel("count").getData().Delayed=g.aDelayedData.length;break;case"":g.getView().getModel("modelEditFlag").setProperty("/Editable",false);g.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false);g.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);g.getView().getModel("count").getData().Total=a.results.length;break;default:break}}else{var p;if(i==="tableData"&&e==="P"){p=g.aPendingData}else if(i==="tableData"&&e==="D"){p=g.aDelayedData}else{p=a.results}g.getView().setModel(new t(p),"ModelForTable")}g.getView().getModel("count").refresh(true)},error:function(e){g.getView().setBusy(false);a.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}})},onOrderNumber:function(e){var t=e.getParameter("value");var a=new sap.ui.model.Filter({path:"Pafno",operator:sap.ui.model.FilterOperator.Contains,value1:t});var i=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.Products.Table"));i.getBinding("items").filter(a);i.setShowOverlay(false);var i=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","table"));i.getBinding("rows").filter(a);i.setShowOverlay(false)},onNewPress:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.navTo("page2",{ID:"null"})},onBack:function(){this.getOwnerComponent().getRouter().navTo("RouteView1",{})},onClickofItem:function(e){var t=e.getParameter("rowContext").getObject().Pafno;this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.navTo("page2",{ID:t})},onFilterSelect:function(e){this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.orderNumber.Input")).setValue("");var t=e.getParameter("key");var a=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.PafNo.Input")).getValue();var i=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.SalesOffice.Input")).getValue();var s=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","idV1InpCustCode")).getValue();var l=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","idV1SLVertical")).getSelectedKey();var r=new sap.ui.model.Filter([new sap.ui.model.Filter("Vkbur",sap.ui.model.FilterOperator.EQ,i)],false);var o=new sap.ui.model.Filter([new sap.ui.model.Filter("Pafno",sap.ui.model.FilterOperator.EQ,a)],false);var d=new sap.ui.model.Filter([new sap.ui.model.Filter("Kunnr",sap.ui.model.FilterOperator.EQ,s)],false);var n=new sap.ui.model.Filter([new sap.ui.model.Filter("Spart",sap.ui.model.FilterOperator.EQ,l)],false);if(t==="All"){this._getRequestData("","tableData",r,o,d,n);this.getView().getModel("modelEditFlag").setProperty("/Editable",false);this.getView().getModel("modelVisibleFlag").setProperty("/Visible",true);this.getView().getModel("oGlobleModel").setProperty("/mode","None");this.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false)}else if(t==="Delay"){this._getRequestData("D","tableData",r,o,d,n);this.getView().getModel("modelEditFlag").setProperty("/Editable",true);this.getView().getModel("modelVisibleFlag").setProperty("/Visible",false);this.getView().getModel("oGlobleModel").setProperty("/mode","SingleSelectLeft");this.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(true)}else if(t==="OnGoing"){this._getRequestData("P","tableData",r,o,d,n);this.getView().getModel("modelEditFlag").setProperty("/Editable",true);this.getView().getModel("modelVisibleFlag").setProperty("/Visible",false);this.getView().getModel("oGlobleModel").setProperty("/mode","SingleSelectLeft");this.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(true)}else if(t==="Approved"){this._getRequestData("A","tableData",r,o,d,n);this.getView().getModel("modelEditFlag").setProperty("/Editable",false);this.getView().getModel("modelVisibleFlag").setProperty("/Visible",false);this.getView().getModel("oGlobleModel").setProperty("/mode","None");this.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false)}else if(t==="Rejected"){this._getRequestData("R","tableData",r,o,d,n);this.getView().getModel("modelEditFlag").setProperty("/Editable",false);this.getView().getModel("modelVisibleFlag").setProperty("/Visible",false);this.getView().getModel("oGlobleModel").setProperty("/mode","None");this.getView().getModel("oGlobleModel").setProperty("/deleteButton",false);this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.TblBtnDelet")).setVisible(false)}},_onDelete:function(e){var t=this.byId(sap.ui.core.Fragment.createId("id.tableProductDetails.Fragment","id.main.Products.Table"));var i=t.getSelectedItems();if(i.length>0){var s=t.getSelectedItem().oBindingContexts.ModelForTable.sPath;var l=this.getView().getModel("ModelForTable").getContext(s).getProperty("Pafno");var r="/ET_Sales_coord_HSet('"+l+"')";var o=this;a.confirm("Are you sure you want to delete Order No:'"+l+"' ?",{actions:["Yes","No"],onClose:function(e){if(e==="Yes"){o.getView().setBusy(true);o.getView().getModel().read(r,{success:function(e){o.getView().setBusy(false);a.success("Order No:'"+l+"' Deleted",{actions:["Ok"],onClose:function(e){window.location.reload()}})},error:function(e){o.getView().setBusy(false);a.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}})}else{}}})}else{a.error("Please Select a Row to Delete")}}})});
//# sourceMappingURL=Main.controller.js.map