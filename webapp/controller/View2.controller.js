sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/IconPool","sap/ui/core/Icon","sap/m/Link","sap/m/MessageItem","sap/m/MessageView","sap/m/Button","sap/m/Bar","sap/m/Title","sap/m/Popover","sap/m/MessageBox","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/valueHelps","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/validation","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/salesOffice","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/customerCode","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/materialFreightGroup","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/designs","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/supplyPlant","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/manufacturingPlant","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/part","zpj/pro/sk/sd/salesco/zprosalesco/utils/View2/quality","sap/m/PDFViewer","sap/ui/core/Fragment","sap/ui/core/format/DateFormat","sap/m/MessageToast","sap/ui/core/util/ExportTypeCSV","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/unified/FileUploader"],function(e,t,a,r,i,o,s,l,n,d,u,g,c,p,h,f,m,S,V,y,P,w,M,b,v,O,D,I,C,_){"use strict";var E=I.EdmType;return e.extend("zpj.pro.sk.sd.salesco.zprosalesco.controller.View2",{onInit:function(){this.vTemp=1;this.getOwnerComponent().getRouter().attachRoutePatternMatched(this.onRouteMatched,this);this._fileDetail;this.Pafno;this._allAttachment=[];this._attachmentPayload;var e=this.getOwnerComponent().getModel("valueHelp").getData();this.getView().setModel(new t(e),"LocalJSONModels");this.bindingContextPath;var a=this.getOwnerComponent().getModel("attachments").getData();this.getView().setModel(new t(a),"LocalJSONModelForAttachment");var r=new t([]);this.getView().setModel(r,"oDOAAAttachmentModel");this._filesToUpload={};this._uploadQueue=[];this.opdfViewer=new M;this.getView().addDependent(this.opdfViewer);this.getOwnerComponent().getModel().setSizeLimit(300)},onRouteMatched:function(e){var a={Editable:false,Required:false,createCopy:false,editButton:false,Pending:false};var r={Editable:false};var i=new t(a);this.getView().setModel(i,"GlobalModel");var o=new t(r);this.getView().setModel(o,"GlobalEditableModel");var s=e.getParameter("arguments").ID;this.sID=e.getParameter("arguments").ID;if(s==="null"||s===undefined){this.getView().getModel("LocalJSONModelForAttachment").setData({attachments:{Nav_File_Upload:{results:[]}}});this.clearSummary();this.getView().byId("FileUploaderId").setVisible(true);this.getView().getModel("GlobalModel").setProperty("/Editable",true);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",true);this.getView().getModel("GlobalModel").setProperty("/Pending",false);this.getView().getModel("GlobalModel").setProperty("/createCopy",false);this.getView().byId("idV2OPSSumDetail").setVisible(true);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setEnabled(true);this.getView().byId("idV2OPSubAttach").setVisible(true);var l=this.getOwnerComponent().getModel("payload").getData();l.header.ET_SALES_COORD_ISET.results=[];l.header.ET_SALES_COORD_ISET.results.push(l.item);this.getView().setModel(new t(l.header),"JSONModelPayload");this.onClear();this.getView().byId("ObjectPageLayout").getHeaderTitle().setObjectTitle("Generate New Request");var n=new t([]);this.getView().setModel(n,"oDOAAAttachmentModel")}else{this.clearSummary();this.getView().getModel("GlobalModel").setProperty("/Editable",false);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",false);this.getView().getModel("GlobalModel").setProperty("/Pending",true);this.getView().getModel("GlobalModel").setProperty("/createCopy",true);this.getView().byId("FileUploaderId").setVisible(false);this.getView().byId("idV2OPSSumDetail").setVisible(false);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setEnabled(true);var d=[];var u=new sap.ui.model.Filter([new sap.ui.model.Filter("Pafno",sap.ui.model.FilterOperator.EQ,s)],false);d.push(u);var c="/ET_SALES_COORD_HEADERSet('"+s+"')";this.getView().byId("ObjectPageLayout").getHeaderTitle().setObjectTitle("Display Request Details:"+s.replace(/^0+/,""));var p=this;this.getView().setBusy(true);this.getView().getModel().read(c,{urlParameters:{$expand:"ET_SALES_COORD_ISET"},success:function(e){if(e.Status==="P"||e.Status==="D"){p.getView().getModel("GlobalModel").setProperty("/editButton",true)}else{p.getView().getModel("GlobalModel").setProperty("/editButton",true)}e.Validity=e.Validity.replace(/^0+/,"");var a=e.ET_SALES_COORD_ISET.results;var r=a.length;for(var i=0;i<r;i++){if(a[i].Isexdep===""){a[i].Isexdep=" "}}if(e.Vtweg==="15"||e.Vtweg==="19"||e.Vtweg==="25"||e.Vtweg==="29"){}else{for(var o=0;o<r;o++){a[o].Disc=a[o].Discb;a[o].Discb=null}}p.getView().setModel(new t(e),"JSONModelPayload");if(p.getView().getModel("JSONModelPayload").getProperty("/Vtweg")){p.sPreviousDistributionChannel=p.getView().getModel("JSONModelPayload").getProperty("/Vtweg")}if(p.getView().getModel("JSONModelPayload").getProperty("/Spart")){p.sPreviousVertical=p.getView().getModel("JSONModelPayload").getProperty("/Spart")}p.getView().setBusy(false);p._displaySummaryDetails()},error:function(e){p.getView().setBusy(false);var t=JSON.parse(e.responseText).error.innererror.errordetails[0].message;if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}else{g.error("Something went wrong, Please refresh browser and try again",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}});var h="/ETFILE_UPLOAD_HSet('"+s+"')";p.getView().setBusy(true);p.getView().getModel("ZFILE_UPLOAD_SRV_01").read(h,{urlParameters:{$expand:"Nav_File_Upload"},async:false,success:function(e){p.getView().byId("idV2OPSAttach").setVisible(true);var t=e;p.getView().getModel("LocalJSONModelForAttachment").setData({attachments:t});p.getView().getModel("oDOAAAttachmentModel").setData(t.Nav_File_Upload.results);p.getView().getModel("LocalJSONModelForAttachment").refresh(true);p.getView().setBusy(false)},error:function(e){p.getView().setBusy(false);var t=JSON.parse(e.responseText).error.innererror.errordetails[0].message;if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}else{g.error("Something went wrong, Please refresh browser and try again",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}})}},onCreateCopy:function(){this.getView().getModel("JSONModelPayload").setProperty("/Pafno","");this.getView().getModel("GlobalModel").setProperty("/Editable",true);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",true);this.getView().byId("FileUploaderId").setVisible(true);this.getView().byId("idV2OPSSumDetail").setVisible(true);this.getView().getModel("GlobalModel").setProperty("/editButton",false);this.getView().getModel("GlobalModel").setProperty("/createCopy",false);this.getView().byId("ObjectPageLayout").getHeaderTitle().setObjectTitle("Generate New Request")},onEdit:function(){this.getView().getModel("GlobalModel").setProperty("/createCopy",false);this.getView().getModel("GlobalModel").setProperty("/editButton",false);if(this.sID!=="null"){this.getView().getModel("GlobalModel").setProperty("/Editable",false);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",true);this.getView().byId("FileUploaderId").setVisible(false);this.getView().byId("idV2OPSSumDetail").setVisible(true)}else{this.getView().getModel("GlobalModel").setProperty("/Editable",true);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",true);this.getView().byId("FileUploaderId").setVisible(true);this.getView().byId("idV2OPSSumDetail").setVisible(true)}},onDistributionChannelChange:function(e){var t=e.getSource().getSelectedKey();e.getSource().setValueState("None");this.getView().getModel("JSONModelPayload").setProperty("/Zterm","");var a=e.getSource().getSelectedKey();if(a==="15"||a==="17"||a==="25"||a==="27"||a==="29"){this.getView().getModel("GlobalModel").setProperty("/Required",true)}else{this.getView().getModel("GlobalModel").setProperty("/Required",false)}if(a==="27"||a==="17"){this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setEnabled(true);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2LblPayTerm")).setRequired(true);O.show("Enter 'Discount' per box")}else{this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setEnabled(true);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2LblPayTerm")).setRequired(true);O.show("Enter 'Discount' in Percentage")}if(this.sPreviousDistributionChannel){g.confirm("Products will be refreshed if Distributor Channel changed, Do you wish to continue ",{actions:["Yes","No"],onClose:function(e){if(e==="Yes"){this.sPreviousDistributionChannel=t;this.clearProducts();this.clearSummary()}else{if(this.sPreviousDistributionChannel){this.getView().getModel("JSONModelPayload").setProperty("/Vtweg",this.sPreviousDistributionChannel)}}}.bind(this)})}else{this.sPreviousDistributionChannel=e.getSource().getSelectedKey()}},onVerticalSelectChange:function(e){var t=e.getSource().getSelectedKey();e.getSource().setValueState("None");if(this.sPreviousVertical){g.confirm("Products will be refreshed if Vertical changed, Do you wish to continue ",{actions:["Yes","No"],onClose:function(e){if(e==="Yes"){this.sPreviousVertical=t;this.clearProducts();this.clearSummary()}else{if(this.sPreviousVertical){this.getView().getModel("JSONModelPayload").setProperty("/Spart",this.sPreviousVertical)}}}.bind(this)})}else{this.sPreviousVertical=e.getSource().getSelectedKey()}},clearProducts:function(){var e=this.getView().getModel("JSONModelPayload").getData();var t={Mfrgr:"",Szmm:"",Mvgr2:"",Werks:"",Prodh1:"",CurVolFt:"",TotalVol:"",Disc:null,Discb:null,Commbox:null,Exfacsqft:null,Exdepsqft:null,Commboxp:null,Frgtsqft:null,Compname:null,Complanprice:null,Sbremark:null,Zzprodh4:"",Mvgr5:"",Isexdep:""};e.ET_SALES_COORD_ISET.results=[t];this.getView().getModel("JSONModelPayload").setData(JSON.parse(JSON.stringify(e)))},onCancel:function(){var e=this;g.confirm("Are you sure you want to cancel?",{actions:["Yes","No"],onClose:function(t){if(t==="Yes"){var a=e.getOwnerComponent().getRouter();a.navTo("RouteMain",{})}}.bind(this)})},onClear:function(){this.sPreviousDistributionChannel=null;this.sPreviousVertical=null;var e={Pafvto:null,Kunnr:"",Pafvfrm:null,Ti:"1",Gst:"18",Name:"",Action:"",Zterm:"",Validity:"",Aufnr:"",Vtweg:"",Vkbur:"",Spart:"",ET_SALES_COORD_ISET:{results:[{Mfrgr:"",Szmm:"",Mvgr2:"",Werks:"",Prodh1:"",CurVolFt:"",TotalVol:"",Disc:null,Discb:null,Commbox:null,Exfacsqft:null,Exdepsqft:null,Commboxp:null,Frgtsqft:null,Compname:null,Complanprice:null,Sbremark:null,Zzprodh4:"",Mvgr5:"",Isexdep:""}]}};this.getView().getModel("JSONModelPayload").setData(e);this.getView().getModel("JSONModelPayload").refresh(true)},onBack:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.navTo("RouteMain",{})},_getResourceBundle:function(){return this.getOwnerComponent().getModel("i18nV2").getResourceBundle()},onInvoiceLiveValidation:function(e){e.getSource().setValueState("None");var t=Number(e.getSource().getValue());var a=e.getSource().getValue();if(a.includes(".")){if(a.split(".")[1].length>2){O.show("Only 2 Decimal allowed");a=a.substring(0,a.length-1);e.getSource().setValue(a)}}if(isNaN(t)){g.error("Only numeric values allowed");e.getSource().setValue("")}var r=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(r==="15"||r==="19"||r==="25"||r==="29"){if(t>100){g.error("Percentage value not correct");e.getSource().setValue("")}}},onOrcPerLiveValidation:function(e){var t=e.getSource().getValue();if(t.includes(".")){if(t.split(".")[1].length>2){O.show("Only 2 Decimal allowed");t=t.substring(0,t.length-1);e.getSource().setValue(t)}}e.getSource().setValueState("None");var a=Number(e.getSource().getValue());if(isNaN(a)){g.error("Only numeric values allowed");e.getSource().setValue("")}var r=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(r==="15"||r==="19"||r==="25"||r==="29"){if(a>100){g.error("Percentage value not correct");e.getSource().setValue("")}}},onLiveChange:function(e){e.getSource().setValueState("None")},onValidityNumber:function(e){var t=Number(e.getSource().getValue());if(isNaN(t)){g.error("Only numeric values allowed");e.getSource().setValue("")}var a=e.getSource().getValue();if(a.includes(".")){g.error("Decimal numbers not allowed");e.getSource().setValue("")}},onNumberValidation:function(e){var t=e.getSource().getValue();if(t.includes(".")){if(t.split(".")[1].length>2){O.show("Only 2 Decimal allowed");t=t.substring(0,t.length-1);e.getSource().setValue(t)}}e.getSource().setValueState("None");var a=Number(e.getSource().getValue());if(isNaN(a)){g.error("Only numeric values allowed");e.getSource().setValue("")}},onFrgtValidation:function(e){var t=e.getSource().getValue();if(t.includes(".")){if(t.split(".")[1].length>2){O.show("Only 2 Decimal allowed");t=t.substring(0,t.length-1);e.getSource().setValue(t)}}e.getSource().setValueState("None");var a=Number(e.getSource().getValue());if(isNaN(a)){g.error("Only numeric values allowed");e.getSource().setValue(null)}},onAddRow:function(){var e=p.headerPayloadValidation(this);if(e===1){var t=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var a=p.itemsPayloadValidation(t,this,"Adding new line");if(a===1){var r=this.getView().getModel("JSONModelPayload").getData();var i=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results.length;r.ET_SALES_COORD_ISET.results.push({Mfrgr:"",Szmm:"",Mvgr2:"",Werks:"",Prodh1:"",CurVolFt:"",TotalVol:"",Disc:null,Discb:null,Commbox:null,Exfacsqft:null,Exdepsqft:null,Commboxp:null,Frgtsqft:null,Compname:null,Complanprice:null,Sbremark:null,Zzprodh4:"",Mvgr5:"",Isexdep:""});this.getView().getModel("JSONModelPayload").setData(JSON.parse(JSON.stringify(r)));this.byId(sap.ui.core.Fragment.createId("idV2FragAddPrdDetails","idV2SC")).scrollTo(0,0,500)}}},onDelete:function(e){var t=e.getSource().getParent().getBindingContextPath().split("/").length;var a=Number(e.getSource().getParent().getBindingContextPath().split("/")[t-1]);var r=this.getView().getModel("JSONModelPayload").getData();if(r.ET_SALES_COORD_ISET.results.length>1){r.ET_SALES_COORD_ISET.results[a].Loekz=true}else{g.error("Atlease one entry is required")}this.getView().getModel("JSONModelPayload").setData(JSON.parse(JSON.stringify(r)));var i="Loekz";var o=this.byId(sap.ui.core.Fragment.createId("idV2FragAddPrdDetails","idV2TblProducts"));var s=[];var l=o.getBinding("items");var n=new sap.ui.model.Filter(i,sap.ui.model.FilterOperator.NE,true);s.push(n);l.filter(s);var d=this.getView().getModel("JSONModelPayload").getData();d.Pafvto=new Date(d.Pafvto);d.Pafvfrm=new Date(d.Pafvfrm);var u=d.ET_SALES_COORD_ISET.results;for(let e=0;e<u.length;e++){for(const t in u[e]){if(Object.hasOwnProperty.call(u[e],t)){if(t==="Erdat"){u[e].Erdat=new Date(u[e].Erdat)}}}}},onCustomerCodeHelp:function(){f.onCustomerCodeHelp(this)},onValueHelpSearch_custCode:function(e){f.onValueHelpSearch_custCode(e,this)},onValueHelpConfirm_custCode:function(e){f.onValueHelpConfirm_custCode(e,this)},onCustomerCodeInputSubmit:function(e){f.onCustomerCodeInputSubmit(e,this)},onSuggest_custCode:function(e){f.onSuggest_custCode(e,this)},onCustomerCodeInputChange:function(){f.onCustomerCodeInputChange(this)},onCustomerCodeInputSuggestionSelect:function(e){f.onCustomerCodeInputSuggestionSelect(e,this)},onCustomerCodeLiveChange:function(e){f.onCustomerCodeLiveChange(e)},onSalesOfficeHelp:function(){h.onSalesOfficeHelp(this)},onSalesOfficeInputSubmit:function(e){h.salesOffice_submitCall(e,this)},onValueHelpSearch_salOffice:function(e){h.onSalesOfficeHelpSearch(e,this)},onValueHelpConfirm_salOffice:function(e){h.onSalesOfficeValueHelpConfirm(e,this)},onSuggest_salesOffice:function(e){h.onSuggest_salesOffice(e,this)},onSalesOfficeLiveChange:function(e){h.onSalesOfficeLiveChange(e)},onMaterialFreightGroupsHelp:function(e){m.onMaterialFreightGroupsHelp(e,this)},onMaterialFreightGroupsValueHelpSearch:function(e){m.onMaterialFreightGroupsValueHelpSearch(e,this)},onMaterialFreightGroupsHelpConfirm:function(e){m.onMaterialFreightGroupsHelpConfirm(e,this)},onSuggest_MaterialFreightGroups:function(e){m.onSuggest_MaterialFreightGroups(e,this)},onMaterialFreightGroupInputSubmit:function(e){m.onMaterialFreightGroupInputSubmit(e,this)},onMaterialFreightInputChange:function(e){m.onMaterialFreightInputChange(e,this)},onMaterialFreightInputSuggestionSelect:function(e){m.onMaterialFreightInputSuggestionSelect(e,this)},onMaterialFreightGroupsLiveChange:function(e){m.onMaterialFreightGroupsLiveChange(e)},onDesignsHelp:function(e){var t=this;var a=e.getSource().getParent().getBindingContextPath();var r=t.getView().getModel("JSONModelPayload").getContext(a).getProperty("Mfrgr");t.Mfrgr=e.getSource().getParent().getBindingContextPath()+"/Mfrgr";t.bindingContextPath=e.getSource().getParent().getBindingContextPath()+"/Mvgr2";if(r){var i=t.getView().getModel("i18nV2").getResourceBundle();if(!t.oFragmentDesign){t.oFragmentDesign=sap.ui.xmlfragment("zpj.pro.sk.sd.salesco.zprosalesco.view.fragments.View2.F4s.designsF4",t);t.oFragmentDesign.setTitle(i.getText("view2.F4.title.designs"));t.getView().addDependent(t.SalesOfficerag);t._DesignsTemp=sap.ui.getCore().byId("idSLDesignsValueHelp").clone();t._oTempDesign=sap.ui.getCore().byId("idSLDesignsValueHelp").clone()}var o=[];var s=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"ZMATSOURCE")],false);var l=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,"")],false);var n=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname2",sap.ui.model.FilterOperator.EQ,r)],false);o.push(s);o.push(l);o.push(n);t.oFragmentDesign.setModel(t.getView().getModel());sap.ui.getCore().byId("idSDDesignsF4").bindAggregation("items",{path:"/ET_VALUE_HELPSSet",filters:o,template:t._DesignsTemp});t.oFragmentDesign.open()}else{g.error("Please select 'Material Freight Group' first")}},onValueHelpSearchDesing:function(e){S.onValueHelpSearchDesing(e,this)},onDesignsHelpConfirm:function(e){S.onDesignsHelpConfirm(e,this)},onSuggest_Designs:function(e){S.onSuggest_Designs(e,this)},onDesignsInputSubmit:function(e){S.onDesignsInputSubmit(e,this)},onDesignsLiveChange:function(e){S.onDesignsLiveChange(e)},onSupplyPlantHelp:function(e){V.onSupplyPlantHelp(e,this)},onSupplyPlantValueHelpSearch:function(e){V.onSupplyPlantValueHelpSearch(e,this)},onSupplyPlantHelpConfirm:function(e){V.onSupplyPlantHelpConfirm(e,this)},onSuggest_SupplyPlant:function(e){V.onSuggest_SupplyPlant(e,this)},onSupplyPlantInputSubmit:function(e){V.onSupplyPlantInputSubmit(e,this)},onSupplyPlantLiveChange:function(e){V.onSupplyPlantLiveChange(e)},onManufacturingAmtHelp:function(e){y.onManufacturingAmtHelp(e,this)},onManufacturingPlantValueHelpSearch:function(e){y.onManufacturingPlantValueHelpSearch(e,this)},onManufacturingAmtHelpConfirm:function(e){y.onManufacturingAmtHelpConfirm(e,this)},onSuggest_ManufacturingPlant:function(e){y.onSuggest_ManufacturingPlant(e,this)},onManufacturingPlantInputSubmit:function(e){y.onManufacturingPlantInputSubmit(e,this)},onManufacturingPlantLiveChange:function(e){y.onManufacturingPlantLiveChange(e)},onPartSelectChange:function(e){P.onPartSelectChange(e,this)},onQualitySelectChange:function(e){w.onQualitySelectChange(e,this)},onRadioButtonGroupSelect:function(e){if(e.getSource().getSelectedIndex()===0){this.getView().getModel("JSONModelPayload").getData().Isexdep="F"}else{this.getView().getModel("JSONModelPayload").getData().Isexdep="D"}},onSave:function(){var e=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var t=e.length;for(var a=0;a<t;a++){if(e[a].Discb){if(Number(e[a].Discb)>0){e[a].Disc=e[a].Discb;e[a].Discb=null}}}this.onGenerateBeforeSave()},onGenerateBeforeSave:function(){var e=p.headerPayloadValidation(this);if(e===1){var t=this.getView().getModel("JSONModelPayload").getData();t.Pafvto=new Date(t.Pafvto);t.Pafvfrm=new Date(t.Pafvfrm);var a=t.ET_SALES_COORD_ISET.results;for(let e=0;e<a.length;e++){for(const t in a[e]){if(Object.hasOwnProperty.call(a[e],t)){if(t==="Erdat"){a[e].Erdat=new Date(a[e].Erdat)}}}}this.getView().getModel("JSONModelPayload").refresh(true);var r=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var i=p.itemsPayloadValidation(r,this,"Generate");if(i===1){this.getView().byId("idV2OPSAttach").setVisible(true);this.getView().getModel("JSONModelPayload").getData().Action="GENERATE";var o=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var s=o.length;for(var l=0;l<s;l++){if(o[l].Isexdep===""){o[l].Isexdep=" "}}var n=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(n==="15"||n==="19"||n==="25"||n==="29"){}else{for(var d=0;d<s;d++){o[d].Discb=o[d].Disc;o[d].Disc=null}}var u="/ET_SALES_COORD_HEADERSet";var c=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");var h=this.getView().getModel("JSONModelPayload").getProperty("/Aufnr");var f=this.getView().getModel("JSONModelPayload").getProperty("/Oppu");var m=this.getView().getModel("JSONModelPayload").getProperty("/Proj");var S=this.getView().getModel("JSONModelPayload").getProperty("/Spec");var V=this.getView().getModel("oDOAAAttachmentModel").getData();var y=true;if(c==="15"||c==="17"||c==="25"||c==="27"||c==="29"){if(!h){g.error("'Purchase Order No' is mandatory for selected distribution channel");y=false}else if(!f){g.error("'Oppurtunity ID' is mandatory for selected distribution channel");y=false}else if(!m){g.error("'Project Name and Address' is mandatory for selected distribution channel");y=false}else if(V.length<1){g.error("'Attachment' is mandatory for selected distribution channel");y=false}else{y=true}}if(y){this.getView().setBusy(true);this.getView().getModel().create(u,this.getView().getModel("JSONModelPayload").getData(),{async:false,success:function(e){var t=e.ET_SALES_COORD_ISET.results;var a=t.length;for(var r=0;r<a;r++){if(t[r].Isexdep===""){t[r].Isexdep=" "}}if(e.Vtweg==="15"||e.Vtweg==="19"||e.Vtweg==="25"||e.Vtweg==="29"){}else{var t=e.ET_SALES_COORD_ISET.results;var a=t.length;for(var i=0;i<a;i++){t[i].Disc=t[i].Discb;t[i].Discb=null}}this.getView().setBusy(false);this.getView().getModel("JSONModelPayload").setData(e);this.getView().getModel("JSONModelPayload").refresh(true);this.getView().getModel("GlobalModel").setProperty("/Editable",false);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",false);this.getView().byId("idV2Bar").setVisible(true);this.getView().byId("idV2BtnSave").setVisible(true);this.getView().byId("FileUploaderId").setVisible(false);this.getView().byId("idV2OPSSumDetail").setVisible(true);this._displaySummaryDetails();this.onSaveAfterGenerate()}.bind(this),error:function(e){this.getView().setBusy(false);this.getView().byId("idV2BtnSave").setVisible(false);var t=JSON.parse(e.responseText).error.innererror.errordetails[0].message;if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}else{g.error("Something went wrong, Please refresh browser and try again",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}.bind(this)})}}}},onSaveAfterGenerate:function(){var e=p.headerPayloadValidation(this);if(e===1){var t=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var a=p.itemsPayloadValidation(t,this,"Save");if(a===1){this.getView().getModel("JSONModelPayload").getData().Action="SAVE";var r=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var i=r.length;for(var o=0;o<i;o++){if(r[o].Isexdep===""){r[o].Isexdep=" "}}var s=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(s==="15"||s==="19"||s==="25"||s==="29"){}else{for(var l=0;l<i;l++){r[l].Discb=r[l].Disc;r[l].Disc=null}}var n="/ET_SALES_COORD_HEADERSet";var d=this;this.getView().getModel().create(n,this.getView().getModel("JSONModelPayload").getData(),{async:false,success:function(e){var t=d.getView().getModel("oDOAAAttachmentModel").getData();if(t.length>0){d.getView().getModel("LocalJSONModelForAttachment").getData().attachments.Pafno=e.Pafno;for(var a=0;a<t.length;a++){t[a].Pafno=e.Pafno}var r={Nav_File_Upload:{results:t}};var i="/ETFILE_UPLOAD_HSet";d.getView().setBusy(true);d.getView().getModel("ZFILE_UPLOAD_SRV_01").create(i,r,{async:false,success:function(t){d.getView().setBusy(false);g.success("Request saved successfully with PAF Number:"+e.Pafno.replace(/^0+/,"")+"",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){d.getOwnerComponent().getRouter().navTo("RouteMain",{})}.bind(this)})},error:function(e){d.getView().setBusy(false);var t=JSON.parse(e.responseText).error.innererror.errordetails[0].message;if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}else{g.error("Something went wrong, Please refresh browser and try again",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}})}else{g.success("Request saved successfully with PAF Number:"+e.Pafno.replace(/^0+/,"")+"",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){d.getOwnerComponent().getRouter().navTo("RouteMain",{})}})}},error:function(e){d.getView().setBusy(false);var t=JSON.parse(e.responseText).error.innererror.errordetails[0].message;if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}else{g.error("Something went wrong, Please refresh browser and try again",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}})}}},fireAllInputs:function(){this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2InpCustCode")).fireSubmit();this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2InpSalesOffice")).fireSubmit()},onGenerate:function(){var e=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var t=e.length;for(var a=0;a<t;a++){if(e[a].Discb){if(Number(e[a].Discb)>0){e[a].Disc=e[a].Discb;e[a].Discb=null}}}try{var r=this.onValidate();if(r!=0){var i=this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2InpSalesOffice")).getValue();if(!this.getView().getModel("JSONModelPayload").getData().Vkbur){this.getView().getModel("JSONModelPayload").getData().Vkbur=i}if(i){this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2InpSalesOffice")).setValueState("None");var o=p.headerPayloadValidation(this);var s=this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setValueState("Error").getSelectedKey();if(!s){g.error("Please enter Payment Term");this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setValueState("Error")}else{this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setValueState("None");if(o===1){var l=this.getView().getModel("JSONModelPayload").getData();l.Pafvto=new Date(l.Pafvto);l.Pafvfrm=new Date(l.Pafvfrm);var n=l.ET_SALES_COORD_ISET.results;for(let e=0;e<n.length;e++){for(const t in n[e]){if(Object.hasOwnProperty.call(n[e],t)){if(t==="Erdat"){n[e].Erdat=new Date(n[e].Erdat)}}}}this.getView().getModel("JSONModelPayload").refresh(true);var d=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var u=p.itemsPayloadValidation(d,this,"Generate");if(u===1){this.getView().byId("idV2OPSAttach").setVisible(true);this.getView().getModel("JSONModelPayload").getData().Action="GENERATE";var e=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;var t=e.length;for(var c=0;c<t;c++){if(e[c].Isexdep===""){e[c].Isexdep=" "}}var h=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(h==="15"||h==="19"||h==="25"||h==="29"){}else{for(var a=0;a<t;a++){e[a].Discb=e[a].Disc;e[a].Disc=null}}var f="/ET_SALES_COORD_HEADERSet";this.getView().setBusy(true);this.getView().getModel().create(f,this.getView().getModel("JSONModelPayload").getData(),{async:false,success:function(e){var t=e.ET_SALES_COORD_ISET.results;var a=t.length;for(var r=0;r<a;r++){if(t[r].Isexdep===""){t[r].Isexdep=" "}}if(e.Vtweg==="15"||e.Vtweg==="19"||e.Vtweg==="25"||e.Vtweg==="29"){}else{for(var i=0;i<a;i++){t[i].Disc=t[i].Discb;t[i].Discb=null}}this.getView().setBusy(false);e.Validity=e.Validity.replace(/^0+/,"");this.getView().getModel("JSONModelPayload").setData(e);this.getView().getModel("JSONModelPayload").refresh(true);this.getView().getModel("GlobalModel").setProperty("/Editable",false);this.getView().getModel("GlobalEditableModel").setProperty("/Editable",false);this.getView().byId("idV2Bar").setVisible(true);this.getView().byId("idV2BtnSave").setVisible(true);this.getView().byId("FileUploaderId").setVisible(false);this.getView().byId("idV2OPSSumDetail").setVisible(true);this.getView().getModel("GlobalModel").setProperty("/editButton",true);this.byId(sap.ui.core.Fragment.createId("idV2FragAddPrdDetails","idV2SC")).scrollTo(0,0,500);this._displaySummaryDetails()}.bind(this),error:function(e){this.getView().setBusy(false);this.getView().byId("idV2BtnSave").setVisible(false);if(JSON.parse(e.responseText).error.innererror.errordetails.length>0){var t=JSON.parse(e.responseText).error.innererror.errordetails[0].message}else{var t="Something went wrong, Please check and try again with correct data"}if(this.vTemp===1){this.vTemp+=1;if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}else{g.error("Something went wrong, Please refresh browser and try again",{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}}.bind(this)})}}}}else{this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2InpSalesOffice")).setValueState("Error");g.error("Please enter Sales Office")}}}catch(e){g.error("Please enter Sales Office")}},onValidate:function(){var e=this.getView().getModel("JSONModelPayload").getProperty("/ET_SALES_COORD_ISET/results");for(var t=0;t<e.length;t++){var a=e[t].Mfrgr,r=e[t].Mvgr5,i=e[t].Prodh1,o=e[t].Zzprodh4;for(var s=t+1;s<e.length;s++){console.log(s);if(a===e[s].Mfrgr&&r===e[s].Mvgr5&&i===e[s].Prodh1.toUpperCase()&&o===e[s].Zzprodh4&&s!=Number(t)){g.error("At line number:"+t+", Material Freigth Group:- '"+a+"' and Manufacturing Plant:-'"+i+"' and Part:-'"+r+"' and Quality:-'"+o+"' combination already selected");e[t].Mfrgr="";e[t].Mvgr5="";e[t].Prodh1="";e[t].Zzprodh4="";this.getView().getModel("JSONModelPayload").setProperty("/ET_SALES_COORD_ISET/results",e);return 0}}}},_displaySummaryDetails:function(){var e=0;var t=0;var a=0;var r=0;var i=0;var o=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;for(let d=0;d<o.length;d++){var s;var l;var n=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(n!=="15"||n!=="19"||n!=="25"||n!=="29"){e=e+Number(o[d].Disc)*Number(o[d].TotalVol);s="Per Box"}else{e=e+Number(o[d].Disc)*Number(o[d].TotalVol)/100;s="%"}var n=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(n==="15"||n==="19"||n==="25"||n==="29"){t=t+Number(o[d].Commboxp)*Number(o[d].TotalVol)/100;l="%"}else{t=t+Number(o[d].Commbox)*Number(o[d].TotalVol);l="Per Box"}r=r+Number(o[d].CashDiscount);a=a+Number(o[d].Frgtsqft)*Number(o[d].TotalVol);i=i+Number(o[d].TotalVol)}e=e/i;t=(t/i).toFixed(2);a=(a/i).toFixed(2);r=(r/o.length).toFixed(2);if(e===NaN||e===0||e===""||e===undefined){e="Not Available"}if(t===NaN||t===0||t===""||t===undefined){t="Not Available"}if(a===NaN||a===0||a===""||a===undefined){a="Not Available"}if(r===NaN||r===0||r===""||r===undefined){r="Not Available"}if(s==="%"){e=Number(e)*100;e=e.toFixed(2);this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpInvcDis")).setValue(e.toString()+s)}else{e=Number(e).toFixed(2);this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpInvcDis")).setValue(e.toString()+s)}if(l==="%"){t=t*100;t=Number(t).toFixed(2);this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpOrc")).setValue(t.toString()+l)}else{t=Number(t).toFixed(2);this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpOrc")).setValue(t.toString()+l)}a=Number(a).toFixed(2);r=Number(r).toFixed(2);this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpfraightCost")).setValue(a.toString());this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpPayTermDis")).setValue(r.toString())},clearSummary:function(){this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpInvcDis")).setValue("");this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpOrc")).setValue("");this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpfraightCost")).setValue("");this.byId(sap.ui.core.Fragment.createId("idV2FragSumDeatil","idV2InpPayTermDis")).setValue("")},onBeforeUploadStarts:function(e){var t=this;this.fileName=e.getParameters().item.getFileName();this.fileType=e.getParameters().item.getMediaType();var a=e.getParameters().item.getFileObject();var r=new FileReader;r.onload=function(e){var a=e.currentTarget.result;t.updateFile(t.fileName,t.fileType,a)};r.readAsDataURL(a)},updateFile:function(e,t,a){var r,i,o=1;if(t==="image/jpeg"){r=atob(a.split("data:image/jpeg;base64,")[1]);o=1}else if(t==="image/png"){r=atob(a.split("data:image/png;base64,")[1]);o=1}else if(t==="application/pdf"){r=atob(a.split("data:application/pdf;base64,")[1]);o=1}else{o=0}var s={Filename:e,Attachment:a,Pafno:""};this.getView().getModel("LocalJSONModelForAttachment").setProperty("/attachments/Nav_File_Upload/results",s)},onUploadComplete:function(e){var t=e.getSource();t.getDefaultFileUploader().setValue("")},onViewAttachmentObjectStatusPress:function(e){var t=e.getSource().getParent().getProperty("thumbnailUrl"),a=e.getSource().getParent().getProperty("fileName"),r=e.getSource();var i={ZRFILE:t,ZRFNAME:a};var o=new sap.ui.model.json.JSONModel(i);this.getView().setModel(o,"oModelForImage");if(t.includes("PDF")||t.includes("pdf")){var s=a;var l=atob(t.split("data:application/pdf;base64,")[1]);var n=new Uint8Array(l.length);for(var d=0;d<l.length;d++){n[d]=l.charCodeAt(d)}var u=new Blob([n.buffer],{type:"application/pdf"});var g=URL.createObjectURL(u);jQuery.sap.addUrlWhitelist("blob");this.opdfViewer.setSource(g);this.opdfViewer.setTitle(s);this.opdfViewer.open()}else{if(this.oPopover){this.oPopover.destroy();delete this._pPopover}if(!this._pPopover){this._pPopover=b.load({id:this.getView().getId(),name:"zpj.pro.sk.sd.salesco.zprosalesco.view.fragments.View2.imagePopover",controller:this}).then(function(e){return e;e.setModel(o)})}this._pPopover.then(function(e){e.openBy(r);e.getAggregation("content")[0].setSrc(i.ZRFILE);this.oPopover=e}.bind(this))}},handleClose:function(e){e.getSource().getParent().getParent().destroy()},imageDownload:function(e){const t=this.getView().getModel("oModelForImage").getData().ZRFILE;const a=this.getView().getModel("oModelForImage").getData().ZRFNAME;fetch(t).then(e=>e.blob()).then(e=>{const t=URL.createObjectURL(e);const r=document.createElement("a");r.href=t;r.download=a;r.target="_blank";document.body.appendChild(r);r.click();document.body.removeChild(r)});e.getSource().getParent().getParent().destroy()},onUpload:function(e){this._importExcel(e.getParameter("files")&&e.getParameter("files")[0])},_importExcel:function(e){var t=this;var a={};if(e&&window.FileReader){var r=new FileReader;r.onload=function(e){var r=e.target.result;var i=XLSX.read(r,{type:"binary"});i.SheetNames.forEach(function(e){a=XLSX.utils.sheet_to_row_object_array(i.Sheets[e])});var o=[];var s={Pafvto:null,Kunnr:a[0].Customer_Code,Pafvfrm:null,Ti:"1",Gst:"18",Name:"",Action:"",Zterm:a[0].Payment_Term,Validity:a[0].Validity,Aufnr:a[0].Purchase_Order_No,Vtweg:a[0].Distribution_Channel,Vkbur:a[0].Sales_Office,Spart:a[0].Vertical,Oppu:a[0].Oppurtunity_ID,Specid:a[0].Specifier_ID,Proj:a[0].Project_NameNAddress,Spec:a[0].Specifier_NameNAddress,ET_SALES_COORD_ISET:{results:[]}};var l=["Customer_Code","Payment_Term","Validity","Purchase_Order_No","Distribution_Channel","Sales_Office","Vertical","Oppurtunity_ID","Specifier_ID","Project_NameNAddress","Specifier_NameNAddress","Material_Freight_Group","Design","Supplying_Plant","Manufacturing_Plant","Current_Volume","Total_Volume","Quality","Part","Ex_FACTORYorDEPOT","On_Invoice_Discount","Distribution_Channel","ORC","Freight","Competitor_Name","Competitor_Landed_Price","Remark"];var n=a[0];var d=true;for(var u in n){var c=u;if(l.includes(c)){d=true}else{d=false;break}}if(d){for(var p=0;p<a.length;p++){if(a[p].Customer_Code){var h=p.toString();var f={};f.Mfrgr=a[h].Material_Freight_Group;f.Mvgr2=a[h].Design;f.Werks=a[h].Supplying_Plant;f.Prodh1=a[h].Manufacturing_Plant;f.CurVolFt=a[h].Current_Volume;f.TotalVol=a[h].Total_Volume;f.Zzprodh4=a[h].Quality;f.Mvgr5=a[h].Part;if(!a[h].Ex_FACTORYorDEPOT){f.Isexdep=" "}else{f.Isexdep=a[h].Ex_FACTORYorDEPOT}f.Disc=a[h].On_Invoice_Discount;if(a[0].Distribution_Channel==="15"||a[0].Distribution_Channel==="19"||a[0].Distribution_Channel==="25"||a[0].Distribution_Channel==="29"){f.Commboxp=a[h].ORC}else{f.Commbox=a[h].ORC}f.Frgtsqft=a[h].Freight;f.Compname=a[h].Competitor_Name;f.Complanprice=a[h].Competitor_Landed_Price;f.Sbremark=a[h].Remark;s.ET_SALES_COORD_ISET.results.push(f)}}t.getView().getModel("JSONModelPayload").setData(s);t.getView().getModel("JSONModelPayload").refresh(true);t.fnResolve();t.fireCalls()}else{g.error("Uploaded excel has wrong header, Please correct and re-upload")}};r.onerror=function(e){sap.m.MessageBox.error("Uploaded excel format is wrong, Please check and reupload")};r.readAsBinaryString(e)}},fnResolve:function(){var e=this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2InpCustCode")).getValue(),t=[],a=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"KNA1")],false),r=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,e)],false),i="/Kunnr",o="/Name",s="Entered Customer code is wrong";t.push(a);t.push(r);this._submitCall(e,t,i,o,s);this.getView().setBusy(true);const l=e=>new Promise(t=>setTimeout(t,e));var n=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results.length;[...Array(n)].reduce((e,t,a)=>e.then(()=>l(Math.random()*1e3)).then(()=>{if(a===n-1){this.getView().setBusy(false)}var e="/ET_SALES_COORD_ISET/results/"+a+"",t=e+"/Mfrgr",r=e+"/Szmm",i=this.getView().getModel("JSONModelPayload").getProperty(t),o=[],s=this.getView().getModel("JSONModelPayload").getProperty("/Spart"),l=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname",sap.ui.model.FilterOperator.EQ,"ZPRICECAT")],false),d=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname1",sap.ui.model.FilterOperator.EQ,i)],false),u=new sap.ui.model.Filter([new sap.ui.model.Filter("Domname2",sap.ui.model.FilterOperator.EQ,s)],false),c="Entered Material Freight Group is wrong";o.push(l);o.push(d);o.push(u);if(s){this._submitCall(i,o,t,r,c);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLVertical")).setValueState("None")}else{g.error("Please select vertical first");this.getView().getModel("JSONModelPayload").setProperty(t,"");this.getView().getModel("JSONModelPayload").setProperty(r,"");this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLVertical")).setValueState("Error")}}),Promise.resolve())},fireCalls:function(){p.headerPayloadValidation(this);var e=this.getView().getModel("JSONModelPayload").getData().ET_SALES_COORD_ISET.results;p.itemsPayloadValidation(e,this,"Proceed");var t=this.getView().getModel("JSONModelPayload").getProperty("/Vtweg");if(t==="15"||t==="19"||t==="25"||t==="29"){this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2LblPayTerm")).setRequired(true);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setEnabled(true)}else{this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2LblPayTerm")).setRequired(false);this.byId(sap.ui.core.Fragment.createId("idV2FragGenInfo","idV2SLPaymentTerm")).setEnabled(false)}},_submitCall:function(e,t,a,r,i){if(e){var o="/ET_VALUE_HELPSSet";this.getView().getModel().read(o,{filters:t,success:function(e){if(e.results.length===1){if(a.includes("Mvgr2")){this.getView().getModel("JSONModelPayload").setProperty(a,e.results[0].Ddtext)}else{this.getView().getModel("JSONModelPayload").setProperty(a,e.results[0].DomvalueL)}if(r){this.getView().getModel("JSONModelPayload").setProperty(r,e.results[0].Ddtext)}}else{this.getView().getModel("JSONModelPayload").setProperty(a,"");if(r){this.getView().getModel("JSONModelPayload").setProperty(r,"")}if(this.vTemp===1){this.vTemp+=1;g.error(i)}}}.bind(this),error:function(e){this.getView().setBusy(false);if(this.vTemp===1){this.vTemp+=1;var t="Something went wrong, Please check and try again with correct data";if(t){g.error(t,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}}}.bind(this)})}},handleUploadComplete:function(e){var t="File upload complete. Status: 200",a=parseInt(/\d{3}/.exec(t)[0]),r;if(t){r=a===200?t+" (Upload Success)":t+" (Upload Error)";O.show(r)}},handleUploadPress:function(){var e=this.getView().byId("fileUploader");e.checkFileReadable().then(function(){e.upload()},function(e){O.show("The file cannot be read. It may have changed.")}).then(function(){e.clear()})},onExport:function(){var e,t,a,r,i;if(!this._oTable){this._oTable=this.byId(sap.ui.core.Fragment.createId("idV2FragAddPrdDetails","idV2TblProducts"))}i=this._oTable;t=i.getBinding("items");e=this.createColumnConfig();a={workbook:{columns:e,hierarchyLevel:"Level",textAlign:"Left",wrap:true,context:{sheetName:"Product Details"}},dataSource:t,count:0,fileName:"Product Details.xlsx",worker:false};r=new C(a);r.build().finally(function(){r.destroy()})},createColumnConfig:function(){var e=[];e.push({property:"CustomerCode",type:E.String});e.push({property:"DistributionChannel",type:E.String});e.push({property:"PaymentTerm",type:E.String});e.push({property:"ValidityInDays",type:E.String});e.push({property:"PurchaseOrderNo",type:E.String});e.push({property:"SalesOffice",type:E.String});e.push({property:"Vertical",type:E.String});e.push({property:"MaterialFreightGroup",type:E.String});e.push({property:"Design",type:E.String});e.push({property:"SupplyingPlant",type:E.String});e.push({property:"ManufacturingPlant",type:E.String});e.push({property:"CurrentVolumeInSqft",type:E.String});e.push({property:"TotalVolumeInSqft",type:E.Number});e.push({property:"Quality",type:E.Number});e.push({property:"OnInvoiceDiscount",type:E.Number});e.push({property:"ORCByBox",type:E.Number});e.push({property:"ORCInPer",type:E.Number});e.push({property:"FreightInSqFt",type:E.Number});e.push({property:"CompetitorName",type:E.Number});e.push({property:"CompetitorLandedPrice",type:E.Number});e.push({property:"PartAorB",type:E.Number});e.push({property:"Sbremark",type:E.String});return e},handleUploadChange:function(e){var t=e.getParameter("files");for(var a=0;a<t.length;a++){this._import(t[a])}e.getSource().setValue("")},handleDownloadPress:function(e){var t=e.getSource().getId().split("-")[2];var a=this.getView().getModel("oDOAAAttachmentModel").getData()[t].Attachment,r=this.getView().getModel("oDOAAAttachmentModel").getData()[t].Filename,i=atob(a),o=new Array(i.length),s=r.split(".").pop();var l=this.getFileType(s);for(var n=0;n<i.length;n++){o[n]=i.charCodeAt(n)}const d=new Uint8Array(o);const u=new Blob([d],{type:l});const g=URL.createObjectURL(u);const c=document.createElement("a");c.href=g;c.download="AttachFile."+s;document.body.appendChild(c);c.click();document.body.removeChild(c);URL.revokeObjectURL(g)},getFileType:function(e){if(e==="PNG"||e==="png"){return"image/png"}else if(e==="JPEG"||e==="jpeg"){return"image/jpeg"}else if(e==="PLAIN"||e==="plain"){return"text/plain"}else if(e==="xlsx"||e==="msexcel"){return"application/vnd.ms-excel"}else{return"application/pdf"}},removeAttachment:function(e){var t=this.getView().getModel("oDOAAAttachmentModel");var a=e.getSource().getBindingContext("oDOAAAttachmentModel").getProperty("Filename");var r=t.getData();var i=r.filter(function(e){return e.Filename!==a});t.setData(i);t.refresh()},_import:function(e){var t=this;if(e&&window.FileReader){var a=new FileReader;var r=e.name;a.onload=function(e){var a=this.getView().getModel("oDOAAAttachmentModel").getData();const i=e.target.result;var o={Attachment:btoa(i),Filename:r};a.push(o);t.getView().getModel("oDOAAAttachmentModel").setData(a);t.getView().getModel("oDOAAAttachmentModel").refresh()}.bind(this);a.onerror=function(e){console.log(e);t.getView().setBusy(false)};a.readAsBinaryString(e)}}})});
//# sourceMappingURL=View2.controller.js.map